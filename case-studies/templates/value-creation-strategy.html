<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

    <!-- 
    /------------------------------------------------------------------------------------------------------------\
    | LAST UPDATE: 2507232040…Wed_Jul_23_2025_0840PM                                                             |
    | https://gemini.google.com/app/2245d1ce65e5ab37                                                             |
    | https://github.com/JawnLam/ExitReadyAdvisors/edit/main/case-studies/templates/value-creation-strategy.html |
    \------------------------------------------------------------------------------------------------------------/
    -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presale Valuation Acceleration Coaching</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- D3.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles and animations */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F3F4F6; /* Light gray background */
        }
        
        /* Core Animation Definition */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animation for initial page load */
        .fade-in {
            animation: fadeIn 0.8s ease-in-out forwards;
        }
        
        /* Tab styling */
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            padding: 1rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .tab-button.active {
            background-color: #FEF3C7; /* Amber-100 */
            color: #B45309; /* Amber-700 */
            border-bottom-color: #F59E0B; /* Amber-500 */
            border-radius: 0.375rem 0.375rem 0 0;
        }

        .tab-button:not(.active) {
            color: #6B7280;
        }
        
        .tab-button:not(.active):hover {
            color: #4B5563;
            border-bottom-color: #D1D5DB;
        }

        /* Tab content styling */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* Accordion icon rotation */
        .accordion-header.open .accordion-icon {
            transform: rotate(90deg);
        }
        .accordion-icon {
            transition: transform 0.2s ease-in-out;
        }

        /* --- D3 Map Specific Styles --- */
        #d3-map-container {
            width: 100%;
            height: 75vh; /* Adjusted height to fit within the tab panel */
            position: relative;
            background-color: #f9fafb; /* bg-gray-50 */
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .link {
            fill: none;
            stroke: #9ca3af; /* Gray-400 */
            stroke-opacity: 0.6;
            stroke-width: 1.5px;
        }

        .node {
            cursor: pointer;
        }
        
        .node circle {
            transition: filter 0.3s ease, stroke-width 0.3s ease, stroke 0.3s ease;
        }
        
        .node:hover circle {
            filter: brightness(1.1);
        }
        
        .node-label {
            font-size: 12px;
            fill: #1f2937; /* Dark Gray for readability */
            pointer-events: none;
            user-select: none;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        .center-label { font-size: 18px; font-weight: 700; }
        .objective-label { font-size: 15px; font-weight: 600; }
        .kr-label { font-size: 13px; }
        .kpi-label { font-size: 11px; }

    </style>
</head>
<body class="bg-gray-50 text-gray-800 p-4 sm:p-6 md:p-8">

    <!-- Header Placeholder -->
    <header id="header-placeholder"></header>

    <!-- Main Content -->
    <main id="page-value-creation-strategy" class="max-w-7xl mx-auto py-8" style="display: none;">

        <!-- PageHeader Component -->
        <header class="grid grid-cols-1 md:grid-cols-2 bg-white rounded-xl overflow-hidden shadow-lg">
            <div class="flex items-center justify-center h-48 md:h-auto">
                <img src="https://images.unsplash.com/photo-1627993312204-1a9383fd4b9a?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" 
                     alt="Modern electrical grid infrastructure" 
                     class="object-cover w-full h-full"
                     onerror="this.onerror=null;this.src='https://placehold.co/600x400/000000/FFFFFF?text=J%26S';">
            </div>
            <div class="p-8 flex flex-col justify-start">
                <p class="text-sm font-semibold uppercase tracking-wider text-amber-600">Value Creation Strategy</p>
                <h1 class="text-3xl font-bold text-gray-900 mt-1">Johnson & Sons Heating, Plumbing, & Air</h1>
                <p class="text-gray-600 mt-4">
                    A detailed roadmap of objectives, key results, and management KPIs for accomplishing the investment thesis.
                </p>
            </div>
        </header>

        <!-- Back/Next Navigation -->
        <div class="flex justify-between items-center my-8">
            <a href="baseline-analysis.html" class="baseline-analysis-button inline-flex items-center gap-2 px-4 py-2 bg-red-100 text-red-600 font-medium rounded-lg shadow-sm border border-red-500 hover:bg-red-200 transition">
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
                Baseline Analysis
            </a>
            <a href="exit-ready-analysis.html" class="inline-flex items-center px-4 py-2 bg-green-100 hover:bg-green-200 text-green-600 font-medium rounded-lg shadow-sm border border-green-500 transition">
                Exit Ready Analysis
                <svg class="w-5 h-5 ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                </svg>
            </a>
        </div>

        <!-- Detailed Information with Tabs -->
        <div class="bg-white rounded-xl shadow-lg">
            <!-- Tab Navigation -->
            <div class="border-b border-gray-200 px-6">
                <nav class="-mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs" id="tabs-container">
                    <!-- Tabs will be dynamically generated here -->
                </nav>
            </div>

            <!-- Tab Content Panels -->
            <div class="p-6 min-h-[400px]" id="tab-content-container">
                <!-- Tab content will be dynamically generated here -->
            </div>
        </div>
    </main>

    <!-- Footer Placeholder -->
    <footer id="footer-placeholder"></footer>

    <script>
        // --- DATA ---
        const strategyData = {
            investmentThesis: [
                "Our investment in this pioneering grid infrastructure company is predicated on a fundamental belief that the electrification of everything—from transportation to data centers—is creating a once-in-a-century bottleneck in power distribution. Traditional transformer technology, stagnant for decades, is a critical constraint, plagued by long lead times and an inability to manage the dynamic, bidirectional power flows of a renewable-energy-powered grid. This company’s Solid-State Transformer (SST) technology represents a paradigm shift, offering a smaller, smarter, and more flexible solution that can be deployed rapidly.",
                "Our thesis is to transform this company from a technology leader into a market-dominant force within 36 months. We will achieve this by focusing on high-value private-sector markets (EV charging, data centers) where the pain point of traditional infrastructure is most acute, allowing us to bypass the slower adoption cycles of public utilities. By proving the technology's reliability and building a scalable operational model, we will not only capture significant market share but also create a defensible moat through service-based recurring revenue streams and deep integration with our customers' ecosystems. This strategy will drive both fundamental business improvement and significant multiple expansion upon exit."
            ],
            objectives: [
                {
                    title: "Objective 1: Accelerate Commercialization and Market Penetration",
                    rationale: "The most critical initial step is to increase the magnitude of future cash flows by moving from a technology-focused startup to a commercially-driven enterprise. The company has a proven product but needs to aggressively capture market share in key beachhead segments to validate its business model, generate revenue, and build a track record. Focusing on private-sector customers with urgent needs, such as EV fast-charging networks and data centers, will enable faster sales cycles and provide the proof points necessary to attract larger, more conservative clients in the future.",
                    keyResults: [
                        {
                            title: "Secure Anchor Customers in High-Growth Verticals",
                            description: "This involves identifying and closing deals with at least two major players in each of our three target verticals: EV charging, data centers, and port electrification. These initial customers will serve as lighthouses, validating our technology and business case for the rest of the industry, and providing crucial feedback for refining our product.",
                            kpis: [
                                { title: "New Customer Acquisition Rate", description: "Achieve a rate of 1 new anchor customer signing per quarter. This measures our sales velocity and ability to penetrate target markets." },
                                { title: "Total Contract Value (TCV) Booked", description: "Secure a cumulative TCV of $50 million within the first 18 months. This KPI directly tracks our success in landing commercially significant deals that provide a revenue backlog." },
                                { title: "Sales Cycle Length", description: "Reduce the average sales cycle from initial contact to contract signing from 9 months to 6 months. This demonstrates our ability to streamline the sales process and accelerate revenue recognition." }
                            ]
                        },
                        {
                            title: "Establish a Scalable Manufacturing and Supply Chain Process",
                            description: "To meet the demand generated by new customer acquisition, we must transition from prototype-level production to a robust, scalable manufacturing operation. This involves solidifying partnerships with key component suppliers and implementing a manufacturing process that ensures quality, reduces costs, and shortens lead times.",
                            kpis: [
                                { title: "Unit Production Cost", description: "Decrease the cost per megawatt (MW) of our SST systems by 30% over 24 months through volume purchasing and process optimization. This is essential for achieving competitive pricing and healthy gross margins." },
                                { title: "Production Lead Time", description: "Reduce the time from order to delivery from 6 months to 3 months. This is a critical competitive advantage over traditional transformers, which have lead times exceeding 12 months." },
                                { title: "First Pass Yield (FPY)", description: "Achieve a manufacturing FPY of 95% or higher. This measures our production quality, minimizing costly rework and waste." }
                            ]
                        },
                        {
                            title: "Develop a Services-Led, Recurring Revenue Model",
                            description: "Shift the business model from purely hardware sales to a more valuable, high-margin combination of hardware and recurring services. This includes offering predictive maintenance, grid management software, and energy optimization services, which increases customer lifetime value and builds a stickier, more defensible business.",
                            kpis: [
                                { title: "Annual Recurring Revenue (ARR)", description: "Grow ARR to 20% of total revenue by the end of year three. This tracks our transition towards a more predictable and profitable revenue mix." },
                                { title: "Service Attachment Rate", description: "Achieve a 75% attachment rate for service contracts on all new hardware sales. This measures our success in bundling services with our core product." },
                                { title: "Customer Lifetime Value (CLV)", description: "Increase the projected CLV of our customers by 50% over 24 months. This KPI quantifies the success of our upselling and recurring revenue strategies." }
                            ]
                        }
                    ]
                },
                {
                    title: "Objective 2: De-Risk Technology and Solidify Operational Excellence",
                    rationale: "To enhance the certainty of future cash flows, we must proactively address the key risks associated with a new technology. Proving the long-term reliability of our SSTs in real-world conditions is paramount to overcoming customer hesitation. Building a reputation for operational excellence in deployment, maintenance, and support will create a strong competitive advantage and reduce perceived business risk, which is critical for commanding a premium valuation.",
                    keyResults: [
                        {
                            title: "Demonstrate High Reliability and Uptime in Field Deployments",
                            description: "The long-term reliability of power-electronics-based infrastructure is a primary concern for potential customers. We must gather and showcase extensive data from our initial deployments to prove our systems are as reliable, or more so, than traditional solutions.",
                            kpis: [
                                { title: "Mean Time Between Failures (MTBF)", description: "Achieve an MTBF of over 100,000 hours for our deployed units within 24 months. This is a standard industry metric for reliability that will be critical for sales conversations." },
                                { title: "Fleet-Wide Uptime", description: "Maintain a fleet-wide operational uptime of 99.99%. This demonstrates the real-world performance and dependability of our technology to potential customers." },
                                { title: "Number of Documented Field-Service Events", description: "Track and aim to reduce the number of unplanned maintenance events per unit per year. This provides a direct measure of product stability." }
                            ]
                        },
                        {
                            title: "Streamline Project Deployment and Commissioning",
                            description: "Our ability to deploy projects faster than our competitors is a core part of our value proposition. We must develop a standardized, repeatable process for site assessment, installation, and commissioning to ensure projects are completed on time and on budget, delighting customers and enabling faster revenue recognition.",
                            kpis: [
                                { title: "Average Deployment Time", description: "Reduce the average time from site-ready to full commissioning from 10 days to 3 days. This directly measures our ability to deliver on our 'plug and play' promise." },
                                { title: "On-Time Completion Rate", description: "Achieve a 95% on-time completion rate for all customer projects. This builds our reputation for reliability and execution." },
                                { title: "Customer Satisfaction (CSAT) Score for Deployment", description: "Maintain a CSAT score of 4.8/5.0 or higher specifically related to the installation and commissioning process. This ensures that we create positive customer experiences from day one." }
                            ]
                        },
                        {
                            title: "Obtain Key Industry Certifications and Standards Compliance",
                            description: "To operate within the highly regulated power industry, we must secure all necessary certifications (e.g., UL, IEEE standards). This not only removes a barrier to entry but also serves as an external validation of our product's safety, quality, and design, significantly de-risking the purchase for customers.",
                            kpis: [
                                { title: "Certification Roadmap Progress", description: "Achieve 100% completion of the certification roadmap for target markets within 18 months. This is a critical path item for market access." },
                                { title: "Time to Achieve Certification per Standard", description: "Track the average time required to achieve each new certification. This measures the efficiency of our engineering and compliance teams." },
                                { title: "Number of Target Markets Unlocked by Certification", description: "Quantify the number of addressable markets or customer segments that become accessible upon receiving specific certifications. This links compliance efforts directly to business growth." }
                            ]
                        }
                    ]
                },
                {
                    title: "Objective 3: Build a Durable Competitive Moat",
                    rationale: "To ensure the longevity of our growth and cash flows, we must build a sustainable competitive advantage that extends beyond our initial technological lead. A strong brand, proprietary intellectual property, and high switching costs created through deep ecosystem integration will protect our market position from both incumbents and new entrants, ensuring long-term value creation.",
                    keyResults: [
                        {
                            title: "Establish Brand Leadership as the Premier SST Provider",
                            description: "We need to be seen as the undisputed leader and innovator in the SST space. This requires a concerted effort in marketing, public relations, and thought leadership to build brand equity and establish itself as the go-to name for next-generation power infrastructure.",
                            kpis: [
                                { title: "Share of Voice (SOV)", description: "Achieve the #1 SOV in industry publications and forums related to grid modernization and SSTs. This measures our brand's visibility and authority in the market." },
                                { title: "Inbound Lead Generation", description: "Increase the percentage of qualified leads generated from inbound marketing channels to 40%. This indicates strong brand pull and reduces customer acquisition costs." },
                                { title: "Analyst Report Rankings", description: "Secure a 'Leader' or 'Innovator' position in relevant industry analyst reports (e.g., Gartner, Navigant). This provides powerful third-party validation." }
                            ]
                        },
                        {
                            title: "Expand and Protect the Intellectual Property (IP) Portfolio",
                            description: "Our core technology is a key asset. We must continue to innovate and systematically protect our inventions through patents, particularly in areas such as our modular design, control software, and manufacturing processes. A robust IP portfolio creates a significant barrier to entry for competitors.",
                            kpis: [
                                { title: "Number of New Patents Filed", description: "File a minimum of 10 new strategic patents per year covering core technology and applications. This demonstrates our commitment to ongoing innovation." },
                                { title: "IP Portfolio Breadth Score", description: "Develop a scoring system to rate the strategic coverage of our IP across key technology areas and geographies. We will aim to increase this score by 25% annually." },
                                { title: "Competitive IP Encroachment Rate", description: "Actively monitor and track the number of competitor patents that attempt to encroach on our core technology areas, and measure our response rate. This is a defensive KPI to ensure we protect our moat." }
                            ]
                        },
                        {
                            title: "Drive Deep Integration with Customer and Partner Ecosystems",
                            description: "The ultimate moat is becoming an indispensable part of our customers' operations. By integrating our SST control software with their energy management systems and co-developing solutions with key partners (e.g., battery storage providers, EV charger manufacturers), we create high switching costs.",
                            kpis: [
                                { title: "Number of Certified Integration Partners", description: "Establish formal integration partnerships with at least 5 leading companies in adjacent technology areas (e.g., energy storage, EV charging software). This expands our ecosystem and value proposition." },
                                { title: "API Adoption Rate", description: "Measure the adoption and usage of our public APIs by customers and partners to build custom solutions on our platform. This indicates how deeply embedded we are in their workflows." },
                                { title: "Percentage of Revenue from Integrated Solutions", description: "Track the percentage of our revenue derived from projects that involve deep integration with at least one certified partner. This measures the success of our ecosystem strategy." }
                            ]
                        }
                    ]
                },
                {
                    title: "Objective 4: Optimize Capital Strategy and Balance Sheet",
                    rationale: "To lower the weighted average cost of capital (WACC) and ensure the business is capitalized for hyper-growth, we must manage our balance sheet with discipline and foresight. This involves securing the right mix of capital to fund our aggressive growth plan, improving capital efficiency to maximize our runway, and strengthening investor confidence through transparent and reliable financial reporting.",
                    keyResults: [
                        {
                            title: "Secure a Growth-Oriented Capital Structure",
                            description: "The company will require substantial capital to scale its manufacturing operations and fund working capital. We must secure a strategic funding round that provides ample runway without excessive dilution, bringing in partners who can add value beyond just capital.",
                            kpis: [
                                { title: "Capital Runway", description: "Maintain a minimum of 24 months of cash runway at all times based on the current operating plan. This provides stability, allowing management to focus on execution." },
                                { title: "Cost of Capital", description: "Target a blended cost of capital that is competitive for a growth-stage hardware company. This involves optimizing the mix of equity and strategic debt." },
                                { title: "Investor Syndicate Quality", description: "Measure the strategic value of our investor base by tracking the number of customer or partner introductions and strategic hires facilitated by our investors." }
                            ]
                        },
                        {
                            title: "Improve Working Capital Efficiency",
                            description: "As we scale, managing cash flow will become paramount. We must implement disciplined processes for managing inventory, accounts receivable, and accounts payable to minimize the cash conversion cycle and maximize the effectiveness of our capital.",
                            kpis: [
                                { title: "Cash Conversion Cycle (CCC)", description: "Reduce the CCC by 20% within 18 months. A lower CCC indicates that we require less external capital to fund our growth." },
                                { title: "Inventory Turns", description: "Increase inventory turns from 2x to 4x per year. This indicates we are efficiently managing our raw materials and finished goods." },
                                { title: "Days Sales Outstanding (DSO)", description: "Maintain a DSO of less than 45 days. This ensures that we collect cash from customers on time." }
                            ]
                        },
                        {
                            title: "Implement a Robust Financial Planning & Analysis (FP&A) Function",
                            description: "To build investor confidence and enable agile decision-making, we must establish a best-in-class FP&A function. This will provide management and the board with clear visibility into the company's performance, improve forecast accuracy, and ensure we are allocating resources to the highest-return initiatives.",
                            kpis: [
                                { title: "Budget vs. Actual Variance", description: "Maintain a variance of less than 5% between our budgeted and actual financial results every quarter. This demonstrates predictability and control." },
                                { title: "Forecast Accuracy", description: "Achieve a 90% accuracy rate for our rolling 12-month revenue and cash flow forecasts. This is critical for managing runway and investor expectations." },
                                { title: "Time to Close", description: "Reduce the monthly financial close process from 15 days to 5 days. This provides management with faster insights for decision-making." }
                            ]
                        }
                    ]
                }
            ]
        };
        
        // --- RENDER FUNCTIONS ---
        function createKpiHtml(kpi) {
            return `
                <div class="ml-4 pl-4 border-l-2 border-gray-300">
                    <div class="accordion-header flex justify-between items-center cursor-pointer py-2 group">
                        <h5 class="font-semibold text-gray-700 group-hover:text-black">${kpi.title}</h5>
                        <svg class="accordion-icon w-4 h-4 text-gray-500 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
                    </div>
                    <div class="accordion-content hidden pl-4 pb-2">
                        <p class="text-sm text-gray-600">${kpi.description}</p>
                    </div>
                </div>
            `;
        }
        
        function createKeyResultHtml(kr) {
            const kpisHtml = kr.kpis.map(createKpiHtml).join('');
            return `
                <div class="mt-4">
                    <div class="accordion-header flex justify-between items-center cursor-pointer p-3 bg-gray-100 rounded-lg hover:bg-gray-200 group">
                        <h4 class="font-bold text-gray-800 group-hover:text-black">${kr.title}</h4>
                        <svg class="accordion-icon w-5 h-5 text-gray-600 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
                    </div>
                    <div class="accordion-content hidden pt-2">
                        <p class="text-gray-600 px-3 pb-2">${kr.description}</p>
                        <div class="space-y-2">${kpisHtml}</div>
                    </div>
                </div>
            `;
        }

        function renderObjectiveCard(objective) {
            const keyResultsHtml = objective.keyResults.map(createKeyResultHtml).join('');
            return `
                <div class="space-y-4">
                    <div class="flex items-center mb-4">
                        <h3 class="text-2xl font-bold text-gray-800">${objective.title}</h3>
                    </div>
                    <div class="text-gray-700 space-y-2">
                        <p class="italic text-gray-600">${objective.rationale}</p>
                        <div class="space-y-2">${keyResultsHtml}</div>
                    </div>
                </div>
            `;
        }

        function initializeAccordions() {
            const headers = document.querySelectorAll('.accordion-header');
            headers.forEach(header => {
                header.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const content = header.nextElementSibling;
                    header.classList.toggle('open');
                    if (content) {
                        content.classList.toggle('hidden');
                    }
                });
            });
        }
        
        // --- DYNAMIC PAGE AND TAB INITIALIZATION ---
        let d3MapInitialized = false;

        document.addEventListener('DOMContentLoaded', () => {
            const pageContainer = document.getElementById('page-value-creation-strategy');
            const tabsContainer = document.getElementById('tabs-container');
            const tabContentContainer = document.getElementById('tab-content-container');

            if (!pageContainer || !tabsContainer || !tabContentContainer) return;

            // 1. Create all tabs and content panels dynamically
            let tabsHtml = `<button class="tab-button" data-tab="thesis">Investment Thesis</button>`;
            let contentHtml = `
                <div id="thesis" class="tab-content">
                    <div class="bg-amber-50 p-6 md:p-8 border-2 border-dashed border-amber-300 rounded-xl shadow-inner">
                        <div class="space-y-4 text-amber-800 leading-relaxed">
                            ${strategyData.investmentThesis.map(p => `<p>${p}</p>`).join('')}
                        </div>
                    </div>
                </div>
            `;

            strategyData.objectives.forEach((obj, index) => {
                const tabId = `objective${index + 1}`;
                tabsHtml += `<button class="tab-button" data-tab="${tabId}">Objective ${index + 1}</button>`;
                contentHtml += `<div id="${tabId}" class="tab-content">${renderObjectiveCard(obj)}</div>`;
            });

            // Add the final "Map of Metrics" tab
            tabsHtml += `<button class="tab-button" data-tab="metrics">Map of Metrics</button>`;
            contentHtml += `
                <div id="metrics" class="tab-content">
                    <div id="d3-map-container">
                        <div class="legend absolute bottom-5 right-5 bg-white bg-opacity-75 backdrop-blur-sm p-4 rounded-lg shadow-lg text-gray-800 pointer-events-none">
                            <h4 class="font-bold text-sm mb-2">Legend</h4>
                            <div class="space-y-2">
                                <div class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background: #10B981;"></div><span class="text-xs">Enterprise Value</span></div>
                                <div class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background: #3B82F6;"></div><span class="text-xs">Strategic Objectives</span></div>
                                <div class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background: #F59E0B;"></div><span class="text-xs">Key Results</span></div>
                                <div class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background: #8B5CF6;"></div><span class="text-xs">KPIs</span></div>
                            </div>
                        </div>
                        <button id="rebalance-btn" class="absolute bottom-5 left-5 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-lg transition-colors duration-300">Rebalance</button>
                    </div>
                </div>
            `;

            // 2. Inject the generated HTML
            tabsContainer.innerHTML = tabsHtml;
            tabContentContainer.innerHTML = contentHtml;

            // 3. Set up event listeners and default state
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function switchTab(tabId) {
                tabButtons.forEach(button => {
                    button.classList.toggle('active', button.dataset.tab === tabId);
                });
                tabContents.forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });

                // Lazy-load the D3 map
                if (tabId === 'metrics' && !d3MapInitialized) {
                    initializeD3Map();
                    d3MapInitialized = true;
                }
            }

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.dataset.tab);
                });
            });

            // Set default active tab
            if (tabButtons.length > 0) {
                switchTab('thesis');
            }
            
            // Initialize all accordions after rendering content
            initializeAccordions();

            // Fade in the whole page
            pageContainer.style.display = 'block';
            pageContainer.classList.add('fade-in');
        });

        // --- D3 MAP INITIALIZATION ---
        function initializeD3Map() {
            const d3Data = {
                name: "Intrinsic Enterprise Value", type: "center",
                children: strategyData.objectives.map((obj, i) => ({
                    name: `Obj ${i+1}: ${obj.title.split(':')[1].trim()}`, type: "objective",
                    children: obj.keyResults.map((kr, j) => ({
                        name: `KR ${i+1}.${j+1}: ${kr.title}`, type: "kr",
                        children: kr.kpis.map((kpi, k) => ({
                            name: `${i+1}.${j+1}.${k+1}: ${kpi.title}`, type: "kpi"
                        }))
                    }))
                }))
            };

            const containerEl = document.getElementById('d3-map-container');
            if (!containerEl) return;

            let width = containerEl.clientWidth;
            let height = containerEl.clientHeight;
            const transitionDuration = 400;
            let isRebalanced = false;

            const svg = d3.select("#d3-map-container").append("svg")
                .attr("width", "100%")
                .attr("height", "100%")
                .attr("viewBox", [0, 0, width, height]);

            const g = svg.append("g");
            let link = g.append("g").attr("class", "links").selectAll("path.link");
            let node = g.append("g").attr("class", "nodes").selectAll(".node");

            const colorScale = d3.scaleOrdinal().domain(["center", "objective", "kr", "kpi"]).range(["#10B981", "#3B82F6", "#F59E0B", "#8B5CF6"]);
            const sizeScale = d3.scaleOrdinal().domain(["center", "objective", "kr", "kpi"]).range([45, 35, 25, 15]);

            const simulation = d3.forceSimulation()
                .force("link", d3.forceLink().id(d => d.id).distance(d => {
                    switch (d.source.data.type) {
                        case "center": return 220;
                        case "objective": return 160;
                        case "kr": return 100;
                        default: return 80;
                    }
                }).strength(1))
                .force("charge", d3.forceManyBody().strength(-400))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => sizeScale(d.data.type) + 15))
                .on("tick", ticked);
            
            const root = d3.hierarchy(d3Data);
            root.descendants().forEach((d, i) => {
                d.id = i;
                d._children = d.children;
                if (d.depth > 1) d.children = null;
            });
            
            update();

            function update() {
                const nodes = root.descendants().filter(d => d.parent ? d.parent.children : true);
                const links = root.links().filter(d => d.source.children && d.target.parent.children);

                simulation.nodes(nodes);
                simulation.force("link").links(links);
                simulation.alpha(1).restart();

                link = link.data(links, d => d.target.id);
                link.exit().remove();
                link = link.enter().append("path").attr("class", "link").merge(link);

                node = node.data(nodes, d => d.id);
                node.exit().transition().duration(transitionDuration)
                    .attr("transform", d => `translate(${d.parent.x},${d.parent.y})`)
                    .style("opacity", 0).remove();
                
                const nodeEnter = node.enter().append("g")
                    .attr("class", "node")
                    .attr("transform", d => `translate(${d.parent ? d.parent.x : width/2},${d.parent ? d.parent.y : height/2})`)
                    .style("opacity", 0)
                    .on("click", (event, d) => {
                        if (event.defaultPrevented) return;
                        toggleChildren(d);
                        update();
                    })
                    .call(drag(simulation));

                nodeEnter.append("circle")
                    .attr("r", d => sizeScale(d.data.type))
                    .attr("fill", d => colorScale(d.data.type))
                    .attr("stroke", d => (d._children && !d.children) ? "#1f2937" : d3.color(colorScale(d.data.type)).darker(0.6))
                    .attr("stroke-width", d => (d._children && !d.children) ? 4 : 2);

                nodeEnter.append("text")
                    .attr("class", d => `node-label ${d.data.type}-label`)
                    .attr("text-anchor", "middle").attr("dy", "0.3em")
                    .text(d => d.data.name);

                node = nodeEnter.merge(node);
                
                node.transition().duration(transitionDuration)
                    .style("opacity", 1)
                    .attr("transform", d => `translate(${d.x},${d.y})`);

                node.select('circle').transition().duration(transitionDuration)
                    .attr("stroke", d => (d._children && !d.children) ? "#1f2937" : d3.color(colorScale(d.data.type)).darker(0.6))
                    .attr("stroke-width", d => (d._children && !d.children) ? 4 : 2);
            }
            
            function ticked() {
                node.attr("transform", d => `translate(${d.x},${d.y})`);
                link.attr("d", d => {
                    const dx = d.target.x - d.source.x, dy = d.target.y - d.source.y, length = Math.sqrt(dx * dx + dy * dy);
                    const mx = (d.source.x + d.target.x) / 2, my = (d.source.y + d.target.y) / 2;
                    const px = -dy / length, py = dx / length;
                    const offset = 30; 
                    const cx = mx + offset * px, cy = my + offset * py;
                    return `M${d.source.x},${d.source.y} Q${cx},${cy} ${d.target.x},${d.target.y}`;
                });
            }

            function toggleChildren(d) {
                if (d.children) d.children = null;
                else d.children = d._children;
                if (isRebalanced) unfixAllNodes();
            }

            function drag(simulation) {
                function dragstarted(event, d) {
                    if (isRebalanced) unfixAllNodes();
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x; d.fy = d.y;
                }
                function dragged(event, d) { d.fx = event.x; d.fy = event.y; }
                function dragended(event, d) { if (!event.active) simulation.alphaTarget(0); }
                return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
            }

            const zoom = d3.zoom().scaleExtent([0.1, 5]).on("zoom", (event) => g.attr("transform", event.transform));
            svg.call(zoom);
            
            function handleResize() {
                width = containerEl.clientWidth;
                height = containerEl.clientHeight;
                svg.attr("width", width).attr("height", height).attr("viewBox", [0, 0, width, height]);
                simulation.force("center", d3.forceCenter(width / 2, height / 2));
                if (isRebalanced) rebalanceLayout();
                else simulation.alpha(0.3).restart();
            }
            window.addEventListener('resize', handleResize);

            function unfixAllNodes() {
                node.each(d => { d.fx = null; d.fy = null; });
                isRebalanced = false;
            }

            function rebalanceLayout() {
                svg.transition().duration(750).call(
                    zoom.transform,
                    d3.zoomIdentity,
                    d3.zoomTransform(svg.node()).invert([width / 2, height / 2])
                );

                const allNodes = root.descendants().filter(d => d.parent ? d.parent.children : true);
                const centerNode = allNodes.find(d => d.data.type === 'center');
                if (!centerNode) return;

                centerNode.fx = width / 2; centerNode.fy = height / 2;

                const objectives = allNodes.filter(d => d.data.type === 'objective');
                const objectiveRadius = Math.min(width, height) / 3;
                const objectiveAngleStep = objectives.length > 0 ? (2 * Math.PI) / objectives.length : 0;

                objectives.forEach((obj, i) => {
                    const angle = i * objectiveAngleStep;
                    obj.fx = centerNode.fx + objectiveRadius * Math.cos(angle);
                    obj.fy = centerNode.fy + objectiveRadius * Math.sin(angle);

                    const keyResults = obj.children || [];
                    const krRadius = 130;
                    const krAngleSpread = Math.PI / 2.5;
                    const krAngleStep = keyResults.length > 1 ? krAngleSpread / (keyResults.length - 1) : 0;
                    const baseKRAngle = angle - krAngleSpread / 2;

                    keyResults.forEach((kr, j) => {
                        const krAngle = baseKRAngle + j * krAngleStep;
                        kr.fx = obj.fx + krRadius * Math.cos(krAngle);
                        kr.fy = obj.fy + krRadius * Math.sin(krAngle);

                        const kpis = kr.children || [];
                        const kpiRadius = 85;
                        const kpiAngleSpread = Math.PI / 3;
                        const kpiAngleStep = kpis.length > 1 ? kpiAngleSpread / (kpis.length - 1) : 0;
                        const baseKPIAngle = krAngle - kpiAngleSpread / 2;

                        kpis.forEach((kpi, k) => {
                            const kpiAngle = baseKPIAngle + k * kpiAngleStep;
                            kpi.fx = kr.fx + kpiRadius * Math.cos(kpiAngle);
                            kpi.fy = kr.fy + kpiRadius * Math.sin(kpiAngle);
                        });
                    });
                });
                
                isRebalanced = true;
                simulation.alpha(1).restart();
            }

            d3.select("#rebalance-btn").on("click", rebalanceLayout);
        }

        // --- HEADER AND FOOTER ---
        /**
         * Initializes the mobile menu toggle functionality.
         * This should be called after the header content is loaded.
         */
        function initializeMobileMenu() {
            const menuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (menuButton && mobileMenu) {
                menuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
                    menuButton.setAttribute('aria-expanded', !isExpanded);
                });
            }
        }

        /**
         * Sets the active style for navigation links based on the current URL.
         * This should be called after the header content is loaded.
         */
        function setActiveNavLinks() {
            const currentUrl = window.location.href;
            const navLinks = document.querySelectorAll('nav a'); // Get all nav links

            const linkPaths = {
                'case-studies': 'ExitReadyAdvisors/case-studies/',
                'services.html': 'ExitReadyAdvisors/services.html',
                'about.html': 'ExitReadyAdvisors/about.html'
            };

            for (const link of navLinks) {
                const href = link.getAttribute('href');
                for (const key in linkPaths) {
                    if (href && href.includes(key) && currentUrl.includes(linkPaths[key])) {
                        link.classList.add('bg-gray-900', 'text-white');
                        link.classList.remove('text-gray-500'); // Or similar default class
                    }
                }
            }
        }

        /**
         * Fetches and injects the header and footer, then initializes interactive components.
         */
        async function loadComponents() {
            try {
                const [headerResponse, footerResponse] = await Promise.all([
                    fetch("https://jawnlam.github.io/ExitReadyAdvisors/header.html"),
                    fetch("https://jawnlam.github.io/ExitReadyAdvisors/footer.html")
                ]);

                if (!headerResponse.ok) throw new Error('Header failed to load.');
                if (!footerResponse.ok) throw new Error('Footer failed to load.');

                const headerData = await headerResponse.text();
                const footerData = await footerResponse.text();
                
                document.querySelector("#header-placeholder").innerHTML = headerData;
                document.querySelector("#footer-placeholder").innerHTML = footerData;

                // --- INITIALIZE DYNAMIC COMPONENTS ---
                // These functions are called *after* the header/footer HTML is injected.
                initializeMobileMenu();
                setActiveNavLinks();

            } catch (error) {
                console.error('Error loading components:', error);
                document.querySelector("#header-placeholder").innerHTML = '<div class="bg-gray-800 text-white p-4 text-center">Header could not be loaded.</div>';
                document.querySelector("#footer-placeholder").innerHTML = '<div class="bg-gray-800 text-white p-4 text-center">Footer could not be loaded.</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadComponents);
    </script>

</body>
</html>
